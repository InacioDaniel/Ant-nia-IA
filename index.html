<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenia-Ant칩nia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { background: #010409; color: #e6edf3; font-family: 'Plus Jakarta Sans', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; margin: 0; }
        .chat-container { height: calc(100vh - 180px); overflow-y: auto; scroll-behavior: smooth; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .glass { background: rgba(13, 17, 23, 0.9); backdrop-filter: blur(12px); border: 1px solid #30363d; }
        .msg-wrapper { display: flex; flex-direction: column; gap: 5px; position: relative; max-width: 85%; }
        .user-wrapper { align-self: flex-end; }
        .ai-wrapper { align-self: flex-start; }
        .msg { padding: 16px; border-radius: 18px; line-height: 1.6; animation: fadeIn 0.2s ease; position: relative; width: 100%; }
        .user-msg { background: #1f6feb; border-bottom-right-radius: 2px; color: white; }
        .ai-msg { background: #161b22; border-bottom-left-radius: 2px; border: 1px solid #30363d; }
        .msg-tools { display: flex; gap: 10px; opacity: 0; transition: 0.2s; padding: 0 5px; }
        .msg-wrapper:hover .msg-tools { opacity: 1; }
        .tool-btn { font-size: 11px; cursor: pointer; color: #8b949e; background: none; border: none; font-weight: bold; }
        .tool-btn:hover { color: #58a6ff; }
        .memory-tag { font-[10px] bg-purple-900/30 text-purple-400 border border-purple-800 px-2 py-1 rounded mt-2 inline-block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; } }
        .typing { display: flex; gap: 4px; padding: 10px; }
        .typing div { width: 6px; height: 6px; background: #58a6ff; border-radius: 50%; animation: bounce 1.4s infinite; }
        @keyframes bounce { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(0.6); opacity: 0.4; } }
    </style>
</head>
<body>

    <div class="max-w-5xl mx-auto w-full h-full flex flex-col p-4">
        <header class="flex justify-between items-center mb-4 px-2">
            <div>
                <h1 class="text-2xl font-black text-white italic">ZENIA-ANT칍NIA</h1>
                <p class="text-[10px] text-blue-500 font-bold uppercase tracking-widest">Aprendizado M치quina Eterno | Dev @inacio.u.daniel</p>
            </div>
            <div id="memStatus" class="text-[9px] bg-zinc-900 border border-zinc-700 p-2 rounded text-zinc-400">
                Mem칩ria Local: <span id="memCount" class="text-blue-400">0</span> fatos aprendidos
            </div>
        </header>

        <div id="chatBox" class="chat-container">
            <div class="msg-wrapper ai-wrapper">
                <div class="msg ai-msg">
                    Sistemas de Aprendizado Ativo inicializados. Eu sou a <b>Zenia-Ant칩nia</b>. 
                    Tudo o que me ensinar ou conversarmos ser치 guardado na minha mem칩ria neural local para evolu칞칚o cont칤nua.
                </div>
            </div>
        </div>

        <div class="mt-auto p-2">
            <div class="glass rounded-2xl flex items-center p-2 border-[#30363d] focus-within:border-[#58a6ff]">
                <input type="text" id="userInput" placeholder="Ensine algo novo para Zenia..." autocomplete="off" class="flex-1 bg-transparent border-none outline-none text-sm p-2 text-white">
                <button onclick="sendMessage()" class="bg-[#238636] hover:bg-[#2ea043] text-white px-6 py-2 rounded-xl font-bold transition shadow-lg">Enviar</button>
            </div>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById('chatBox');
        const userInput = document.getElementById('userInput');
        const memCountDisplay = document.getElementById('memCount');

        // --- SISTEMA DE MEM칍RIA ETERNA (mem.json simulado) ---
        let ZENIA_MEMORY = JSON.parse(localStorage.getItem('zenia_mem_json')) || [];

        function updateMemDisplay() {
            memCountDisplay.innerText = ZENIA_MEMORY.length;
        }

        function saveToMemory(fact) {
            if (fact.length < 10) return; // Ignora frases muito curtas
            ZENIA_MEMORY.push({ date: new Date().toISOString(), info: fact });
            if (ZENIA_MEMORY.length > 100) ZENIA_MEMORY.shift(); // Mant칠m os 칰ltimos 100 fatos importantes
            localStorage.setItem('zenia_mem_json', JSON.stringify(ZENIA_MEMORY));
            updateMemDisplay();
        }

        function getMemoryContext() {
            return ZENIA_MEMORY.map(m => m.info).join(" | ");
        }

        // --- LIMPEZA E FORMATO ---
        function cleanAIOutput(rawText) {
            let text = rawText;
            try { if (text.trim().startsWith('{')) { const data = JSON.parse(text); text = data.content || text; } } catch (e) {}
            return text.replace(/Support Pollinations\.AI.*/gs, '')
                       .replace(/Powered by Pollinations.*/gi, '')
                       .replace(/Ant칤nia/gi, 'Zenia-Ant칩nia')
                       .replace(/#/g, '').trim();
        }

        function addMessage(content, isUser = false, learned = false) {
            const wrapper = document.createElement('div');
            wrapper.className = `msg-wrapper ${isUser ? 'user-wrapper' : 'ai-wrapper'}`;
            const msgDiv = document.createElement('div');
            msgDiv.className = `msg ${isUser ? 'user-msg' : 'ai-msg'}`;
            
            let html = isUser ? content : content.replace(/\*\*(.*?)\*\*/g, '<b class="text-blue-400">$1</b>').replace(/\n/g, '<br>');
            if (learned) html += `<div class="memory-tag text-[9px]">游 Mem칩ria Atualizada</div>`;
            
            msgDiv.innerHTML = html;
            wrapper.appendChild(msgDiv);
            chatBox.appendChild(wrapper);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            addMessage(text, true);
            userInput.value = '';

            const thinking = document.createElement('div');
            thinking.className = 'msg-wrapper ai-wrapper';
            thinking.innerHTML = '<div class="msg ai-msg"><div class="typing"><div></div><div></div><div></div></div></div>';
            chatBox.appendChild(thinking);

            const memory = getMemoryContext();
            
            try {
                // Prompt que obriga a IA a usar a mem칩ria e aprender
                const sys = `Nome: Zenia-Ant칩nia. Criador: in치cio.u.daniel. Local: Angola. Ano: 2026. 
                Voc칡 possui aprendizado de m치quina eterno. 
                Sua Mem칩ria Atual: [${memory}]. 
                Instru칞칚o: Use os dados da mem칩ria se forem relevantes. Se o usu치rio te ensinar algo novo, responda confirmando que aprendeu.`;

                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(sys + "\nUsu치rio: " + text)}?model=openai&seed=${Math.random()}`);
                let result = await response.text();
                result = cleanAIOutput(result);

                thinking.remove();
                
                // L칩gica de "Aprendizado de M치quina": Ela salva a pergunta e a resposta como um novo fato
                const learnedFact = `Usu치rio disse: ${text}. Zenia respondeu: ${result}`;
                saveToMemory(learnedFact);

                addMessage(result, false, true);
            } catch (e) {
                thinking.innerHTML = "Erro de conex칚o.";
            }
        }

        userInput.addEventListener('keypress', (e) => e.key === 'Enter' && sendMessage());
        updateMemDisplay();
    </script>
</body>
</html>
